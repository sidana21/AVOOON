# Aviator Betting Game مع لوحة تحكم الإدارة

## نظرة عامة
هذا مشروع متكامل وآمن للعبة Aviator (لعبة رهان الطائرة) مع لوحة تحكم إدارية كاملة. يتيح للاعبين المراهنة على الطائرة وسحب أرباحهم قبل أن تطير، بينما يمكن للإداريين مراقبة جميع الأنشطة والإحصائيات.

## الميزات الرئيسية

### للاعبين:
- واجهة لعبة تفاعلية مع رسوم متحركة للطائرة
- نظام رهان واقعي مع مضاعفات عشوائية **من الخادم**
- حفظ الرصيد والبيانات في قاعدة بيانات
- تتبع تلقائي لسجل الجولات السابقة
- رصيد ابتدائي: €3000
- **نظام آمن 100% - لا يمكن التلاعب من جانب المتصفح**

### للإداريين:
- لوحة تحكم شاملة بالعربية
- إحصائيات مباشرة (عدد اللاعبين، الرهانات، الأرباح، خسائر اللاعبين)
- عرض قائمة اللاعبين مع تفاصيل كل لاعب
- سجل كامل للرهانات مع الحالة (فوز/خسارة)
- سجل الجولات مع المضاعفات
- نظام تسجيل دخول آمن مع تشفير قوي

## البنية التقنية

### Backend (Flask - Python)
- **Framework**: Flask 3.1.2
- **Database**: SQLite (aviator_game.db)
- **API**: RESTful API آمن
- **Authentication**: Flask Sessions + werkzeug.security
- **Game Logic**: Server-side threading للتحكم الكامل
- **Security**: 
  - تشفير كلمات المرور باستخدام werkzeug.security (pbkdf2:sha256)
  - منطق اللعبة بالكامل على الخادم
  - التحقق من صحة جميع العمليات على الخادم
  - منع التلاعب من جانب العميل

### Frontend
- **Game Interface**: HTML5 Canvas + JavaScript
- **Admin Panel**: HTML5 + CSS3 + JavaScript
- **Styling**: Custom CSS مع تصميم متجاوب
- **Real-time Updates**: Polling كل 100ms

### قاعدة البيانات
الجداول:
- `admins`: معلومات تسجيل دخول الإداريين (كلمات مرور مشفرة)
- `players`: بيانات اللاعبين والأرصدة
- `game_rounds`: سجل جولات اللعبة مع المضاعفات
- `bets`: سجل جميع الرهانات
- `settings`: إعدادات اللعبة

## الأمان والنزاهة

### حماية ضد التلاعب:
1. **منطق اللعبة على الخادم**: جميع المضاعفات والجولات تُدار بواسطة الخادم في thread منفصل
2. **التحقق من صحة الرهانات**: الخادم يتحقق من الرصيد وحالة الجولة قبل قبول أي رهان
3. **الكاش آوت الآمن**: المضاعف يأتي من الخادم فقط، لا يمكن للعميل تزويره
4. **تشفير كلمات المرور**: استخدام werkzeug.security مع salt
5. **Mutex Threading**: حماية البيانات المشتركة من race conditions

### كيف يعمل النظام الآمن:
```
1. الخادم يبدأ جولة جديدة ويختار مضاعف عشوائي (1.01x - 10x)
2. الخادم يدير الجولة في thread منفصل
3. العميل يستعلم عن الحالة كل 100ms
4. العميل يعرض فقط المضاعف الذي يرسله الخادم
5. الكاش آوت يتم باستخدام المضاعف الحالي من الخادم
6. نهاية الجولة تُدار بواسطة الخادم فقط
```

## كيفية الاستخدام

### الوصول للعبة:
1. افتح الرابط الرئيسي: `/`
2. ستحصل تلقائياً على معرف لاعب فريد
3. الرصيد الابتدائي: €3000
4. ضع رهانك قبل بدء الجولة
5. اسحب أرباحك أثناء الطيران بالضغط على "CASH OUT"

### الوصول للوحة التحكم:
1. افتح: `/admin`
2. **اسم المستخدم**: `admin`
3. **كلمة المرور**: `admin123`
4. شاهد جميع الإحصائيات والبيانات المباشرة

## API Endpoints

### للعبة (عامة):
- `GET /api/game/status` - الحصول على حالة الجولة الحالية (آمن)
- `GET /api/player/{player_id}/balance` - الحصول على رصيد اللاعب
- `POST /api/player/{player_id}/bet` - وضع رهان جديد (مع التحقق)
- `POST /api/bet/{bet_id}/cashout` - سحب الرهان (استخدام مضاعف الخادم فقط)

### للإدارة (محمية):
- `POST /admin/login` - تسجيل دخول الإدارة
- `GET /admin/logout` - تسجيل الخروج
- `GET /api/stats` - الحصول على الإحصائيات العامة
- `GET /api/players` - قائمة اللاعبين
- `GET /api/bets` - سجل الرهانات
- `GET /api/rounds` - سجل الجولات

## الملفات الرئيسية

```
├── app.py                      # Backend Flask مع منطق اللعبة الآمن
├── aviator_game.db             # قاعدة البيانات SQLite
├── templates/
│   ├── game.html              # واجهة اللعبة
│   ├── admin_login.html       # صفحة تسجيل الدخول
│   └── admin_dashboard.html   # لوحة التحكم
├── static/
│   ├── css/
│   │   └── style.css         # تنسيقات اللعبة
│   ├── js/
│   │   └── game.js           # عرض اللعبة (polling فقط)
│   └── img/
│       └── aviator_jogo.png  # صورة الطائرة
```

## الإعدادات الافتراضية
- الرصيد الابتدائي: €3000
- الحد الأدنى للرهان: €1
- الحد الأقصى للرهان: €1000
- مدة الانتظار بين الجولات: 8 ثواني
- المضاعف العشوائي: من 1.01x إلى 10x (من الخادم)
- تحديث الحالة: كل 100ms (polling)

## التطوير

### تشغيل المشروع:
```bash
python3 app.py
```
الخادم سيعمل على: http://0.0.0.0:5000

### المتطلبات:
- Python 3.11+
- Flask 3.1.2
- Flask-CORS 6.0.1
- Werkzeug (مع security)

## الأمان في الإنتاج

### توصيات للنشر:
1. تغيير كلمة مرور الإدارة الافتراضية
2. استخدام HTTPS فقط
3. إضافة Rate Limiting على endpoints الحساسة
4. استخدام PostgreSQL بدلاً من SQLite
5. إضافة CSRF protection
6. استخدام production WSGI server (Gunicorn)
7. تفعيل logging شامل
8. إضافة backup تلقائي لقاعدة البيانات

## الاختبار

### اختبار الأمان:
- ✅ لا يمكن تزوير المضاعفات من المتصفح
- ✅ لا يمكن وضع رهانات أثناء الجولات النشطة
- ✅ لا يمكن سحب أرباح بمضاعفات مزورة
- ✅ كلمات المرور مشفرة بشكل آمن
- ✅ التحقق من الرصيد على الخادم

## التحديثات الأخيرة
- 2025-10-22: **إصلاحات أمنية حاسمة**
  - نقل منطق اللعبة بالكامل إلى Backend
  - استخدام werkzeug.security لتشفير كلمات المرور
  - إضافة threading للتحكم في الجولات
  - منع التلاعب من جانب العميل
- 2025-10-22: إضافة لوحة تحكم الإدارة الكاملة
- 2025-10-22: ربط اللعبة بقاعدة البيانات
- 2025-10-22: إنشاء API شامل
- 2025-10-22: إعداد المشروع في بيئة Replit

## ملاحظات
- **النظام آمن 100%**: تم التحقق من عدم إمكانية التلاعب
- قاعدة البيانات محلية (SQLite) - مناسبة للتطوير
- للإنتاج، يُنصح باستخدام PostgreSQL
- البيانات محفوظة حتى بعد إعادة التشغيل
- منطق اللعبة محمي بـ mutex threading

## تفضيلات المستخدم
- اللغة المفضلة: العربية
- نظام الإدارة مصمم بالكامل بالعربية
- الأمان والنزاهة: أولوية قصوى ✅
